<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ghidra Interface — Interactive Preview</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#0f1724;--panel:#0b1220;--muted:#93a0b3;--accent:#7c3aed;--glass:rgba(255,255,255,0.04)}
    *{box-sizing:border-box;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#071026 0%, #092033 60%);color:#e6eef6}
    .app{display:grid;grid-template-columns:300px 1fr 420px;gap:18px;padding:20px;height:100vh}
    .left,.center,.right{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:14px;box-shadow:0 6px 18px rgba(2,6,23,0.6);}
    .header{display:flex;align-items:center;gap:12px;margin-bottom:12px}
    .logo{width:44px;height:44px;border-radius:8px;background:linear-gradient(135deg,var(--accent),#2fb3ff);display:flex;align-items:center;justify-content:center;font-weight:700}
    h1{font-size:16px;margin:0}
    p.sub{margin:0;color:var(--muted);font-size:12px}

    /* Left panel - controls & functions */
    .functions{height:calc(100% - 72px);overflow:auto;padding-right:6px}
    .fn{display:flex;align-items:center;gap:10px;padding:10px;border-radius:8px;margin-bottom:8px;background:var(--glass);cursor:pointer;transition:all .15s}
    .fn:hover{transform:translateY(-3px);box-shadow:0 6px 20px rgba(12,20,40,0.6)}
    .fn .badge{background:#07162b;padding:6px;border-radius:6px;font-weight:600;color:var(--accent);min-width:36px;text-align:center}
    .fn .label{font-weight:600}
    .controls{display:flex;gap:8px;margin-top:10px}
    .btn{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 10px;border-radius:8px;color:var(--muted);cursor:pointer}
    .btn.primary{background:linear-gradient(90deg,var(--accent),#2fb3ff);border:0;color:#031025}

    /* center - graph and decompiler */
    .graph-area{height:52%;border-radius:8px;background:linear-gradient(0deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));padding:10px;position:relative}
    .svg-wrap{width:100%;height:100%;overflow:hidden}
    svg{width:100%;height:100%}
    .decompiler{margin-top:12px;border-radius:8px;padding:12px;height:42%;overflow:auto;background:#021426;border:1px solid rgba(255,255,255,0.03)}
    .code{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, 'Roboto Mono', monospace;background:transparent;color:#d9eef8;white-space:pre-wrap}

    /* right - listing & bytes & strings */
    .panel-title{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .tabs{display:flex;gap:8px}
    .tab{padding:6px 8px;border-radius:8px;background:transparent;color:var(--muted);cursor:pointer}
    .tab.active{background:rgba(255,255,255,0.03);color:#fff}
    .listing, .bytes, .strings{height:calc(100% - 38px);overflow:auto;padding:8px;border-radius:8px;background:#021426;border:1px solid rgba(255,255,255,0.03)}
    .line{font-family:ui-monospace,monospace;color:#bcd7ea;font-size:13px;padding:4px;border-radius:6px}
    .line.highlight{background:linear-gradient(90deg, rgba(124,58,237,0.12), rgba(47,179,255,0.06));color:#fff}

    /* footer */
    .footer{position:absolute;left:20px;bottom:20px;color:var(--muted);font-size:13px}

    /* responsive */
    @media (max-width:1100px){.app{grid-template-columns:1fr;grid-auto-rows:350px 1fr 300px}}
  </style>
</head>
<body>
  <div class="app">
    <div class="left">
      <div class="header">
        <div class="logo">G</div>
        <div>
          <h1>Ghidra Preview</h1>
          <p class="sub">Interactive UI — Function Graph & Decompiler</p>
        </div>
      </div>

      <div class="functions" id="functions">
        <!-- functions list populated by JS -->
      </div>

      <div class="controls">
        <button class="btn" id="resetBtn">Reset Layout</button>
        <button class="btn primary" id="centerGraphBtn">Center Graph</button>
      </div>
    </div>

    <div class="center">
      <div class="graph-area">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
          <strong>Function Graph</strong>
          <div style="color:var(--muted);font-size:13px">Click a node to update Decompiler</div>
        </div>
        <div class="svg-wrap">
          <svg id="graphSvg" xmlns="http://www.w3.org/2000/svg"></svg>
        </div>
      </div>

      <div class="decompiler">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
          <strong>Decompiler (Pseudocode)</strong>
          <div style="color:var(--muted);font-size:13px" id="selectedNodeLabel">Selected: Entry</div>
        </div>
        <pre class="code" id="decompilerCode">// Select a node in the graph to view decompiled pseudocode.

int main() {
    // waiting for user to pick a block...
}
</pre>
      </div>
    </div>

    <div class="right">
      <div class="panel-title">
        <strong>Disassembly & Bytes</strong>
        <div class="tabs">
          <div class="tab active" id="tabListing">Listing</div>
          <div class="tab" id="tabBytes">Bytes</div>
          <div class="tab" id="tabStrings">Strings</div>
        </div>
      </div>

      <div class="listing" id="listingView">
        <!-- disassembly lines -->
      </div>
      <div class="bytes" id="bytesView" style="display:none">
        <!-- bytes -->
      </div>
      <div class="strings" id="stringsView" style="display:none">
        <!-- strings -->
      </div>
    </div>

    <div class="footer">Interactive preview • Click nodes • Drag them • Hover to inspect</div>
  </div>

  <script>
    // Sample graph data (nodes + edges) + associated content
    const nodes = [
      {id:'n1', label:'Entry', x:120, y:40, code:`int main(){\n    // entry block\n    if(check()) goto n2;\n    return 0;\n}`},
      {id:'n2', label:'If Check', x:120, y:170, code:`if(len>0){\n    process_buffer(buffer);\n}`},
      {id:'n3', label:'Process', x:340, y:170, code:`void process_buffer(char *b){\n    sanitize(b);\n    write_log();\n}`},
      {id:'n4', label:'Exit', x:220, y:300, code:`// cleanup and exit\nclose_handles();\nreturn;`}
    ];
    const edges = [
      {from:'n1',to:'n2'},
      {from:'n2',to:'n3'},
      {from:'n2',to:'n4'},
      {from:'n3',to:'n4'}
    ];

    const svg = document.getElementById('graphSvg');
    const NS = 'http://www.w3.org/2000/svg';

    function createGraph(){
      svg.innerHTML='';
      // defs for marker
      const defs = document.createElementNS(NS,'defs');
      defs.innerHTML = `<marker id="arrow" markerWidth="10" markerHeight="10" refX="10" refY="5" orient="auto"><path d="M0,0 L10,5 L0,10 z" fill="#8fbdf0"/></marker>`;
      svg.appendChild(defs);

      // edges
      edges.forEach(e=>{
        const n1 = nodes.find(n=>n.id===e.from);
        const n2 = nodes.find(n=>n.id===e.to);
        const line = document.createElementNS(NS,'path');
        const startX = n1.x+80, startY = n1.y+25;
        const endX = n2.x, endY = n2.y+15;
        const d = `M ${startX} ${startY} C ${startX+40} ${startY} ${endX-40} ${endY} ${endX} ${endY}`;
        line.setAttribute('d',d);
        line.setAttribute('stroke','#3da8ff');
        line.setAttribute('stroke-width',2);
        line.setAttribute('fill','none');
        line.setAttribute('marker-end','url(#arrow)');
        svg.appendChild(line);
      });

      // nodes
      nodes.forEach(n=>{
        const g = document.createElementNS(NS,'g');
        g.setAttribute('class','node');
        g.setAttribute('transform',`translate(${n.x},${n.y})`);
        g.style.cursor='grab';

        const rect = document.createElementNS(NS,'rect');
        rect.setAttribute('width',120);
        rect.setAttribute('height',50);
        rect.setAttribute('rx',10);
        rect.setAttribute('fill','#042235');
        rect.setAttribute('stroke','rgba(124,58,237,0.9)');
        rect.setAttribute('stroke-width',1.5);
        rect.setAttribute('filter','');

        const text = document.createElementNS(NS,'text');
        text.setAttribute('x',12);
        text.setAttribute('y',28);
        text.setAttribute('fill','#bfe9ff');
        text.setAttribute('font-size',14);
        text.textContent = n.label;

        g.appendChild(rect);
        g.appendChild(text);
        svg.appendChild(g);

        // interaction
        g.addEventListener('click',()=>{selectNode(n.id)});
        makeDraggable(g,n);
      });
    }

    function makeDraggable(g,node){
      let isDown=false, startX, startY, origX=node.x, origY=node.y;
      g.addEventListener('mousedown', (ev)=>{isDown=true; startX=ev.clientX; startY=ev.clientY; g.style.cursor='grabbing';});
      window.addEventListener('mousemove',(ev)=>{if(!isDown) return; const dx=ev.clientX-startX; const dy=ev.clientY-startY; const nx=origX+dx; const ny=origY+dy; node.x=nx; node.y=ny; g.setAttribute('transform',`translate(${nx},${ny})`); updateEdges();});
      window.addEventListener('mouseup',(ev)=>{if(!isDown) return; isDown=false; origX=node.x; origY=node.y; g.style.cursor='grab';});
    }

    function updateEdges(){
      // remove and redraw edges for simplicity
      Array.from(svg.querySelectorAll('path')).forEach(p=>p.remove());
      edges.forEach(e=>{
        const n1 = nodes.find(n=>n.id===e.from);
        const n2 = nodes.find(n=>n.id===e.to);
        const line = document.createElementNS(NS,'path');
        const startX = n1.x+80, startY = n1.y+25;
        const endX = n2.x, endY = n2.y+15;
        const d = `M ${startX} ${startY} C ${startX+40} ${startY} ${endX-40} ${endY} ${endX} ${endY}`;
        line.setAttribute('d',d);
        line.setAttribute('stroke','#3da8ff');
        line.setAttribute('stroke-width',2);
        line.setAttribute('fill','none');
        line.setAttribute('marker-end','url(#arrow)');
        svg.appendChild(line);
      });
    }

    function selectNode(id){
      const n = nodes.find(x=>x.id===id);
      document.getElementById('decompilerCode').textContent = n.code;
      document.getElementById('selectedNodeLabel').textContent = 'Selected: ' + n.label;
      highlightListing(id);
    }

    function highlightListing(id){
      const listing = document.getElementById('listingView');
      listing.innerHTML='';
      const map = {
        'n1':['00400000 55        PUSH RBP','00400001 48 89 E5 MOV RBP,RSP','00400004 48 83 EC10 SUB RSP,0x10'],
        'n2':['00400008 48 8B 45 F8 MOV RAX,[RBP-8]','0040000C 83 F8 00 CMP EAX,0x0','00400010 74 0A JE 0040001C'],
        'n3':['0040001C 48 89 C7 MOV RDI,RAX','00400020 E8 A0 FD FF FF CALL 0040F0A0','00400025 48 85 C0 TEST RAX,RAX'],
        'n4':['00400030 5D POP RBP','00400031 C3 RET']
      };
      (map[id]||[]).forEach((l,i)=>{
        const div = document.createElement('div'); div.className='line highlight'; div.textContent = l; listing.appendChild(div);
      });
      if(!(map[id]||[]).length){ listing.innerHTML='<div class="line">No disassembly segment mapped.</div>'}

      // update bytes and strings as well
      const bytesView = document.getElementById('bytesView');
      bytesView.innerHTML='';
      const bytesSample = ['55 48 89 E5','48 83 EC 10','48 8B 45 F8','48 89 C7 E8'];
      bytesSample.forEach(b=>{const d = document.createElement('div'); d.className='line'; d.textContent=b; bytesView.appendChild(d)});

      const stringsView = document.getElementById('stringsView');
      stringsView.innerHTML='';
      const stringsSample = ['"System check OK"','"Startup simulation"','"ping.exe"'];
      stringsSample.forEach(s=>{const d = document.createElement('div'); d.className='line'; d.textContent=s; stringsView.appendChild(d)});
    }

    // populate functions list
    const fnList = document.getElementById('functions');
    nodes.forEach((n,idx)=>{
      const el = document.createElement('div'); el.className='fn'; el.innerHTML = `<div class="badge">F${idx+1}</div><div><div class="label">${n.label}</div><div style="font-size:12px;color:var(--muted)">0x0040${100+idx.toString(16).toUpperCase()}</div></div>`;
      el.addEventListener('click',()=>selectNode(n.id));
      fnList.appendChild(el);
    });

    // tabs
    document.getElementById('tabListing').addEventListener('click',()=>{document.getElementById('listingView').style.display='block';document.getElementById('bytesView').style.display='none';document.getElementById('stringsView').style.display='none';document.getElementById('tabListing').classList.add('active');document.getElementById('tabBytes').classList.remove('active');document.getElementById('tabStrings').classList.remove('active');});
    document.getElementById('tabBytes').addEventListener('click',()=>{document.getElementById('listingView').style.display='none';document.getElementById('bytesView').style.display='block';document.getElementById('stringsView').style.display='none';document.getElementById('tabListing').classList.remove('active');document.getElementById('tabBytes').classList.add('active');document.getElementById('tabStrings').classList.remove('active');});
    document.getElementById('tabStrings').addEventListener('click',()=>{document.getElementById('listingView').style.display='none';document.getElementById('bytesView').style.display='none';document.getElementById('stringsView').style.display='block';document.getElementById('tabListing').classList.remove('active');document.getElementById('tabBytes').classList.remove('active');document.getElementById('tabStrings').classList.add('active');});

    document.getElementById('resetBtn').addEventListener('click',()=>{nodes[0].x=120;nodes[0].y=40;nodes[1].x=120;nodes[1].y=170;nodes[2].x=340;nodes[2].y=170;nodes[3].x=220;nodes[3].y=300;createGraph();});
    document.getElementById('centerGraphBtn').addEventListener('click',()=>{svg.setAttribute('viewBox','0 0 800 420');});

    // init
    createGraph();
    selectNode('n1');
  </script>
</body>
</html>